---
title: "Отладка неправильного поведения утилиты xdg-open"
date: "2024-04-22T22:01:55+03:00"
lastmod: 2025-05-16
categories:
  - opensource
  - debug
tags:
  - xdg-open
---

Проблема началась с того что после монтирования контейнера `Veracrypt`, перестал открываться нормально файловый менеджер. Он открывался, но параллельно открывался браузер. Ранее такого поведения не было.

<!--more-->

Я начал расследование этой ситуации. Помнится, уже когда то возился с утилитами `xdg-utils` куда входит утилита `xdg-open`: 

> *открытие каталога ассоциированным приложением*
> 
> ```bash
> xdg-open ~/Downloads/
> ```
> 
> *просмотр файлового типа ассоциации для файла*
> 
> ```bash
> xdg-mime query filetype ~/Downloads/
> ```
> 
> *установка приложения по по умолчанию для файловой ассоциации*
> 
> ```bash
> xdg-mime default nemo.desktop inode/directory
> ```

Я начал пробовать смотреть как настроены ассоциации через утилиты командной строки. Натолкнулся на то что утилита `xdg-open` открывает путь до точки монтирования не корректно:

```bash
xdg-open /run/media/dp/test
```

Воспроизвелась ситуация когда открывается ОДНОВРЕМЕННО браузер и файловый менеджер.

Начал смотреть в эту сторону `xdg-open`. После того как я сделал изменения зафиксированные [здесь](https://gitlab.freedesktop.org/xdg/xdg-utils/-/merge_requests/110), поведение была исправлено.
Но ментейнер проекта отказался принимать изменения пока не докопается до причины такого поведения. В целом согласимся, так как это правильно)

Побочным эффектом явилось то, что ментейнер предложил обходное решение в виде в файл конфигурации ассоциаций `~/.config/mimeapps.list `

```bash
inode/directory=nemo.desktop
inode/mount-point=nemo.desktop
```

Здесь можно прописать ваши ассоциации.

Причиной проблем явился баг в утилите `mimetype` пакета `perl-file-mimeinfo`. Пакет `perl-file-mimeinfo` являеется зависимостью пакета `xdg-utils`, куда входит утилита `xdg-open`. Утилита `mimetype` используется в скрипте `xdg-open`.

На момент разбора, в коде утилиты `mimetype` производился безусловный выход с кодом [ошибки](https://github.com/mbeijen/File-MimeInfo/issues/54). Было сформирован [MR](https://github.com/mbeijen/File-MimeInfo/pull/55) c исправлением.

Ждем когда исправления будут доставлены в дистрибутивы.